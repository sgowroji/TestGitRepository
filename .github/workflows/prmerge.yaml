name: Comment on Approved PRs

on:
  schedule:
    - cron: '*/2 * * * *'  
    
jobs:
  comment-on-approved-prs:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    - name: Get all merged pull requests
      id: get_prs
      run: |
        echo "::set-output name=prs::$(curl -s -H \"Accept: application/vnd.github.v3+json\" https://api.github.com/repos/${{ github.repository }}/pulls?state=closed | jq '.[] | select(.merged_at != null and .state == \"closed\") | {number: .number, merged_at: .merged_at, user: .user.login}' | jq -s '.')"

    - name: Comment on approved PRs
      uses: actions/github-script@v5
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
            const script = require('./\.github/workflows/scripts/merge.js')
            script({github, context})
          
